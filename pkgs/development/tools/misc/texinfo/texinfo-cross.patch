From 1b398c61bed22f7599b72da99bb15b9278f94e39 Mon Sep 17 00:00:00 2001
From: Ben Wolsieffer <benwolsieffer@gmail.com>
Date: Tue, 30 Jul 2019 17:47:11 -0400
Subject: [PATCH] Pass extra environment variables to native tools build to
 allow cross-compiling with Nix.

---
 configure.ac | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/configure.ac b/configure.ac
index a6e3d2818..99b819bc6 100644
--- a/configure.ac
+++ b/configure.ac
@@ -212,10 +212,12 @@ else
   # env -i gives this build host configure a clean environment;
   # consequently, we have to re-initialize $PATH.
   env -i CC="$BUILD_CC" AR="$BUILD_AR" RANLIB="$BUILD_RANLIB" \
-      PATH="$PATH" \
-      tools_only=1 \
-    ${confdir}/configure --build=${build} --host=${build} \
-                         --disable-rpath --disable-nls
+         PATH="$PATH" tools_only=1 \
+         ${confdir}/configure PERL="$PERL" AWK="$AWK" \
+                              CFLAGS="$NIX_BUILD_CFLAGS_COMPILE" \
+                              LDFLAGS="$NIX_BUILD_LDFLAGS" \
+                              --build=${build} --host=${build} \
+                              --disable-rpath --disable-nls
   cd .. || exit 1
   AC_MSG_NOTICE([[Continuing with main configure (${host}).]])
 fi
-- 
2.22.0

